---
import { getEntry, getCollection } from 'astro:content'
import Card from '../NonPost/Card.astro'

/**
 * 反向链接组件 - 显示引用当前文章的其他文章
 *
 * 使用示例：
 * <Backlinks postSlug={post.slug} />
 */

interface Props {
  inlinks: string[]
  title?: string
}

const { inlinks, title = '被以下文章引用' } = Astro.props

const inlinkList = []
// 找到当前文章
for (const inlink of inlinks) {
  const inPost = await getEntry('posts', inlink)
  if (inPost) {
    inlinkList.push(inPost)
  }
}
---

{
  inlinkList.length > 0 && (
    <Card
      class="backlinks-section"
      title={title}
    >
      <ul
        class="divide-y"
        style="border-color: var(--color-alt);"
      >
        {inlinkList.map((post) => (
          <li
            class="py-4 first:pt-0"
            style="border-color: var(--color-alt);"
          >
            <a
              href={`/post/${post.data.slug}`}
              class="text-sm line-clamp-2 transition-colors block "
              style="color: var(--color-t);"
              onmouseover="this.style.color='var(--color-link)'"
              onmouseout="this.style.color='var(--color-t)'"
            >
              {post.data.title}
            </a>
            <time
              class="text-xs block mt-1"
              style="color: var(--color-t-l);"
            >
              {new Date(post.data.created).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
              })}
            </time>
          </li>
        ))}
      </ul>
    </Card>
  )
}
