---
import Card from '../NonPost/Card.astro'
import { getSiteStats } from '@/utils/siteStats'

interface Post {
  slug: string
  title: string
  created: number
}

interface Props {
  posts?: Post[]
}

const props = Astro.props as Props
let { posts } = props
if (!posts) {
  const site = await getSiteStats()
  posts = (site.posts ?? [])
    .sort((a, b) => b.created - a.created)
    .slice(0, 5)
    .map((p) => ({ slug: p.slug, title: p.title, created: p.created }))
}
---

{
  posts.length > 0 && (
    <Card title="最近文章">
      <ul
        class="divide-y"
        style="border-color: var(--color-alt);"
      >
        {posts.map((post) => (
          <li
            class="py-4 first:pt-0"
            style="border-color: var(--color-alt);"
          >
            <a
              href={`/post/${post.slug}`}
              class="text-sm line-clamp-2 transition-colors block "
              style="color: var(--color-t);"
              onmouseover="this.style.color='var(--color-link)'"
              onmouseout="this.style.color='var(--color-t)'"
            >
              {post.title}
            </a>
            <time
              class="text-xs block mt-1"
              style="color: var(--color-t-l);"
            >
              {new Date(post.created).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
              })}
            </time>
          </li>
        ))}
      </ul>
    </Card>
  )
}
