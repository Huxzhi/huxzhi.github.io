---
import Home from '@/components/Home.astro'
import { sortByPin } from '@/shared/tag'
import config from 'urodele.config'
import { getPageList } from './api/post/list'

const page = Number(Astro.params.page)
const allPosts = sortByPin(await getPageList())
const pageSize = config.pagination.size
const posts = allPosts.slice(page * pageSize, page * pageSize + pageSize)

export const getStaticPaths = async () => {
  const { default: config } = await import('urodele.config')
  const pageSize = config.pagination.size
  const posts = sortByPin(await getPageList())
  const pages = Math.ceil(posts.length / pageSize)
  return Array.from({ length: pages }, (_, i) => i)
    .filter((v) => v !== 0)
    .map((p) => ({
      params: {
        page: p,
      },
    }))
}
---

<Home
  posts={posts}
  page={page}
  pages={Math.ceil(allPosts.length / pageSize)}
/>
